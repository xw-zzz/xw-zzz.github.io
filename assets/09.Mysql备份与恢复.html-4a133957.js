import{_ as n}from"./plugin-vue_export-helper-c27b6911.js";import{r as e,o as l,c as t,a as s,e as p,d as o,b as i}from"./app-ef0b4d9d.js";const d="/assets/image-20221103115717750-5598db4d.png",r="/assets/image-20221103115841694-79e103a3.png",c="/assets/image-20221103142939886-f7851daf.png",m="/assets/image-20221103143037467-12edeb5b.png",u="/assets/image-20221103144035974-8cf5efbb.png",v={},k=i(`<h2 id="概述" tabindex="-1"><a class="header-anchor" href="#概述" aria-hidden="true">#</a> 概述</h2><p>备份数据库非常重要，这样在出现问题时，如系统崩溃、硬件故障、错误删除数据等情况都可以恢复数据并重新启动和运行。</p><h2 id="备份类型" tabindex="-1"><a class="header-anchor" href="#备份类型" aria-hidden="true">#</a> 备份类型</h2><p>物理备份由存储数据库内容的目录和文件的原始副本组成。这种类型的备份适用于出现问题时需要快速恢复的大型、重要数据库。逻辑备份保存表示为逻辑数据库结构,如 DDL 和 DML 语句。这种类型的备份适用于少量的数据。</p><p><strong>物理备份特性：</strong></p><ul><li>备份由数据库目录和文件的结构组成。相对于逻辑备份占用的空间更小，恢复速度更快。</li><li>除了备份数据库以外，备份还可以包括任何相关文件，如日志或配置文件。</li><li>备份只能移植到具有相同或类似硬件特征的其他计算机上。</li><li>备份可以在MySQL服务器未运行时执行。如果服务器正在运行，则会执行适当的锁定，以便服务器在备份期间不会更改数据库内容。</li></ul><p><strong>逻辑备份特性：</strong></p><ul><li><p>逻辑备份是通过查询MySQL服务器来获取数据库的结构和内容信息。</p></li><li><p>逻辑备份比物理方法慢，因为服务器必须访问数据库信息并将其转换为逻辑格式。</p></li><li><p>逻辑备份文件比物理备份文件更大。</p></li><li><p>逻辑备份不能备份日志和配置文件。</p></li><li><p>逻辑格式存储的备份是独立于机器的，并且具有<strong>高度的可移植性</strong>。</p></li></ul><h2 id="mysqldump" tabindex="-1"><a class="header-anchor" href="#mysqldump" aria-hidden="true">#</a> mysqldump</h2><h3 id="sql格式备份恢复" tabindex="-1"><a class="header-anchor" href="#sql格式备份恢复" aria-hidden="true">#</a> SQL格式备份恢复</h3><h4 id="备份" tabindex="-1"><a class="header-anchor" href="#备份" aria-hidden="true">#</a> 备份</h4><p>mysqldump用于进行逻辑备份，命令格式如下：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysqldump <span class="token punctuation">[</span>arguments<span class="token punctuation">]</span> <span class="token operator">&gt;</span> file_name

<span class="token comment">## 1 备份所有数据库：</span>
mysqldump <span class="token comment">--all-databases &gt; dump.sql</span>

<span class="token comment">## 2 备份指定数据库</span>
mysqldump <span class="token comment">--databases db1 db2 db3 &gt; dump.sql</span>

<span class="token comment">## 3 备份指定数据库</span>
mysqldump test <span class="token operator">&gt;</span> <span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>

<span class="token comment">## 备份某个库下的指定表</span>
mysqldump test t1 t3 t7 <span class="token operator">&gt;</span> <span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>：：：note</p><p>加 <code>--databases</code> 会添加创库语句和use语句，不加则不会生成。</p><p>：：：</p><p>执行命令 <code>mysqldump -uroot -p123456 --databases test&gt;/usr/mysql/data/tmp.sql</code>,生成的Sql如下图所示：</p><p><img src="`+d+'" alt="image-20221103115717750" loading="lazy"></p><p>执行命令 <code>mysqldump -uroot -p123456 test&gt;/usr/mysql/data/tmp.sql</code>,生成的Sql如下图所示：</p><p><img src="'+r+`" alt="image-20221103115841694" loading="lazy"></p><h4 id="回滚" tabindex="-1"><a class="header-anchor" href="#回滚" aria-hidden="true">#</a> 回滚</h4><p>命令如下：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 <span class="token operator">&lt;</span><span class="token operator">/</span>usr<span class="token operator">/</span>mysql<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>tmp<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>如果回滚Sql文件没有包含建库和use语句，需要先创建数据库，恢复时指定数据库，命令如下：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token comment">## 创建数据库 test</span>
mysqladmin <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 <span class="token keyword">create</span> test

<span class="token comment">## 恢复数据</span>
mysql <span class="token operator">-</span>uroot <span class="token operator">-</span>p123456 test <span class="token operator">&lt;</span><span class="token operator">/</span>usr<span class="token operator">/</span>mysql<span class="token operator">/</span><span class="token keyword">data</span><span class="token operator">/</span>tmp<span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="binlog恢复" tabindex="-1"><a class="header-anchor" href="#binlog恢复" aria-hidden="true">#</a> binlog恢复</h2><ul><li>查看binlog列表</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">BINARY</span> LOGS<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+c+`" alt="image-20221103142939886" loading="lazy"></p><ul><li>获取当前二进制日志文件的名称</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SHOW</span> MASTER <span class="token keyword">STATUS</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="`+m+`" alt="image-20221103143037467" loading="lazy"></p><ul><li>根据时间段查询指定的SQL语句，示例如下：</li></ul><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysqlbinlog <span class="token comment">--start-datetime=&quot;2022-10-11 20:05:00&quot; \\</span>
                   <span class="token comment">--stop-datetime=&quot;2023-11-11 20:08:00&quot; --verbose \\</span>
         <span class="token operator">/</span>var<span class="token operator">/</span>lib<span class="token operator">/</span>mysql<span class="token operator">/</span>binlog<span class="token punctuation">.</span><span class="token number">000002</span> <span class="token operator">|</span> grep <span class="token operator">-</span>C <span class="token number">15</span> <span class="token string">&quot;DROP TABLE&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+u+`" alt="image-20221103144035974" loading="lazy"></p><p>在3165处删除了user表，接下来进行回滚操作：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>mysqlbinlog --start-position=3088 --stop-position=3165 /var/lib/mysql/binlog.000002 \\
         | mysql -u root -p
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="使用建议" tabindex="-1"><a class="header-anchor" href="#使用建议" aria-hidden="true">#</a> 使用建议</h2><ul><li><p>尽量不要在<code>mysqldump</code>命令行上使用<code>——databases</code>，因为这会导致dump文件中包含use db1语句，会导致下面 <code>mysql db2 &lt; dump.sql</code> 语句无效。</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysqldump db1 <span class="token operator">&gt;</span> <span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
mysqladmin <span class="token keyword">create</span> db2
mysql db2 <span class="token operator">&lt;</span> <span class="token keyword">dump</span><span class="token punctuation">.</span><span class="token keyword">sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h2 id="参考文章" tabindex="-1"><a class="header-anchor" href="#参考文章" aria-hidden="true">#</a> 参考文章</h2>`,40),b={href:"https://dev.mysql.com/doc/refman/8.0/en/backup-types.html",target:"_blank",rel:"noopener noreferrer"};function g(q,h){const a=e("ExternalLinkIcon");return l(),t("div",null,[k,s("ul",null,[s("li",null,[s("a",b,[p("https://dev.mysql.com/doc/refman/8.0/en/backup-types.html"),o(a)])])])])}const f=n(v,[["render",g],["__file","09.Mysql备份与恢复.html.vue"]]);export{f as default};
